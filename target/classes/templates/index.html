<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<title>Order Page</title>

<style>
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
body{
            overflow-x: hidden;
     }
</style>

</head>
<body>
	<nav class="navbar" style="background-color: black;">
        <div class="col-md-6">
          <a class="navbar-brand" href="#" style="margin-left: 5%;">
            <img
            	th:src="@{/images/logo3.jpg}"
              width="15%"
              alt=""
              loading="lazy"
            />
          </a>
        </div>
          
          <div class="col-md-6" style="color:azure">
            <div style="text-align: right; margin-right: 10%;"><span  style="font-weight: 500;" >Contact : </span><span style="font-weight: 200;">+91-123-456-789</span>&nbsp&nbsp&nbsp
            <span  style="font-weight: 500;" >Timings : </span><span style="font-weight: 200;">11:00 AM - 10:00 PM</span>
            </div>
        </div>
      </nav>
      
      <div class="container-fluid px-0">
        <div class="row">
          <div class="col-md-12">
            <img th:src="@{/images/hero.jpg}" alt=".." width="100%" class="img-responsive" />
          </div>
         </div>
      </div>
      
	<script>
	var ETA;


	const orderNow = ()=>{
			
	 var rates = document.getElementsByName('menu');
	 var coup = document.getElementsByName('coupon');
	 var disc;
	if (coup[0].checked){
		disc= coup[0].value; 
	}else{
		disc = coup[1].value;
	}
var rate_value=0;
for(var i = 0; i < rates.length; i=i+2){
    if(rates[i].checked){
		
        rate_value += parseInt(rates[i].value)*parseInt(rates[i+1].value);
        }
}

if (rate_value < 100){
	alert("THE BASE BILL SHOULD BE GREATER THAN 100");
	return;
}


var modal = document.getElementById("myModal");
modal.style.display = "block";
rate_value = rate_value-(rate_value*disc)/100;
var content = document.getElementsByClassName("modal-content")[0];
content.innerHTML="";
var money = document.createTextNode(rate_value);
content.appendChild(money);

}
	
  const userAction = async () => {
	var city = document.getElementById('cityName').value
  const response = await fetch('http://localhost:8080/getresto?cityName='+city);
  const myJson = await response.json(); //extract JSON from the http response
  
  
  var node = document.getElementById("resto")
  for(var item in myJson) {
	
	radiobox = document.createElement('input');
    radiobox.type = 'radio';
    radiobox.name = "resta";
    radiobox.value = myJson[item][0];
    radiobox.eta = myJson[item][1];
    
    var label = document.createElement('label')
    label.htmlFor = myJson[item][0];
 
    var description = document.createTextNode(myJson[item][0]);
    label.appendChild(description);
 
    var newline = document.createElement('br')
    
    node.appendChild(radiobox);
    node.appendChild(label);
    node.appendChild(newline);

}
  
}

  const userSel = async()=>{
 var rates = document.getElementsByName('resta');
var rate_value;
for(var i = 0; i < rates.length; i++){
    if(rates[i].checked){
		ETA = rates[i].eta;
        rate_value = rates[i].value;
           var str = 'http://localhost:8080/getmenu?restName=' + rate_value;
    	const response = await fetch(str);
  	const myJson = await response.json(); 
  var node = document.getElementById("menu")
  for(var item in myJson) {
  		
  	radiobox = document.createElement('input');
    radiobox.type = 'checkbox';
    radiobox.name = "menu";
    radiobox.value = myJson[item];
    radiobox.label="Hello";
    
    var label = document.createElement('label')
    label.htmlFor = item;
 	label.className="food"
    var description = document.createTextNode(item+'  Price :  ' + myJson[item]);
    label.appendChild(description);
 	
 	var quantity = document.createElement('input')
 	quantity.type = 'text'
 	quantity.name = "menu";
 	
    var newline = document.createElement('br')
    
    node.appendChild(radiobox);
    node.appendChild(label);
    node.appendChild(quantity);
    node.appendChild(newline);
  		
}
    }
    }
 
}


const can = ()=>{
	alert("You have cancelled the order");
	document.location.reload(true)
}

function cancel(){
alert("YOU CAN CANCEL THE ORDER NOW")
document.getElementById("can").style.visibility = "visible";
}

const PayNow=()=>{
	setTimeout(cancel,ETA*1000)
	document.getElementById("myModal").style.visibility = "hidden";
}

const Discard=()=>{
	document.location.reload(true)
}

const back=()=>{
	var modal = document.getElementById("myModal");
	modal.style.display = "none";
}
	</script>
<p>Please enter your city</p>
<input type="text" id="cityName" name="cityName">
	<button onclick="userAction()">Get Restaurants</button>	
<div id="resto">
</div>

<button onclick="userSel()">Get Menu</button>	
<div id="menu">
</div>

 <input type="radio" value="50" id="SAVE50" name="coupon">
 <label for="50">SAVE 50</label>
 <input type="radio" value="20" id="SAVE20" name="coupon">
 <label for="20">SAVE 20</label>
<button id="myBtn" onclick="orderNow()">Order food</button>

<div id="myModal" class="modal">
<button type="button" class="close"
                               onclick="back()">
                            Back to cart
                        </button>
  <!-- Modal content -->
  <div class="modal-content">
	
  </div>
<button id="payment" onclick="PayNow()">Pay</button>
<button id="Discard" onclick="Discard()">Discard</button>
</div>

<button id="can" onclick="can()" style="visibility: hidden;">Cancel the order</button>

<footer style="background-color: black;">
        <!-- Copyright -->
        <div class="text-center p-3" style="color:white;">
          Â© 2021 Copyright : Restro 
        </div>
        <!-- Copyright -->
      </footer>
</body>
</html>